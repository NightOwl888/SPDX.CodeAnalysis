# Renovate configuration
# Schema reference: https://docs.renovatebot.com/renovate-schema.json

# ASF-friendly base, loosened for testing
extends:
  - config:recommended
  - :dependencyDashboard
  - :prConcurrentLimitNone
  - :prHourlyLimitNone

enabledManagers:
  - nuget
  - github-actions

# Default for NuGet: bump lower bound of ranges
rangeStrategy: bump

# During testing: run at any time (not weekly only)
schedule:
  - "at any time"

packageRules:
  # Group 1: Test dependencies
  - groupName: "Test dependencies"
    matchPackageNames:
      - NUnit
      - NUnit3TestAdapter
      - Microsoft.NET.Test.Sdk
    labels: ["dependencies", "test-deps"]

  # Group 2: Roslyn packages
  - groupName: "Roslyn dependencies"
    matchPackagePatterns:
      - "^Microsoft\\.CodeAnalysis"
    labels: ["dependencies", "roslyn"]

  # Exclude manual packages (leave for manual bumping)
  - matchPackageNames:
      - Microsoft.VSSDK.BuildTools
    enabled: false
    labels: ["dependencies", "manual-upgrade"]

  # Analyzer dependencies: always bump to latest
  - matchPackagePatterns:
      - "Analyzer"
    updateTypes: ["minor", "patch", "major"]
    labels: ["dependencies", "analyzers"]

  # GitHub Actions: ASF-compliant mode (pin to commit SHA)
  - matchManagers:
      - github-actions
    pinDigests: true
    rangeStrategy: pin
    commitMessageTopic: "GitHub Action {{depName}}"
    labels: ["dependencies", "ci"]

  # Renovate doesn't understand the "sources" element in global.json, so igore it
  - matchFileNames:
      - "global.json"
    enabled: false

# Only update main branch
baseBranches:
  - main

# ASF-safe: never automerge
automerge: false

# Disable Renovate's onboarding PR
onboarding: false
